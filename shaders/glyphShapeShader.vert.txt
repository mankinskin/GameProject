#version 450

layout(location = 0) in vec2 pos;
layout(location = 1) in vec4 quad;
layout(location = 2) in unsigned int index;


struct Glyph{
	
	vec2 min;
	vec2 max;
};

struct Quad{
	vec2 pos;
	vec2 size;
};

struct Style{
	float thickness;
	float hardness;
	vec2 pad;
};

layout(std140) uniform GlyphBuffer{
	vec4 glyphs[255];
};

layout(std140) uniform GeneralUniformBuffer{
	vec4 generalUniformBuffer[9];
};

layout(std140) uniform StyleBuffer{
	Style styleBuffer[100];
};

out Vertex{
	vec2 uv;
	Style style;
}outVer;

uniform unsigned int styleIndex;

void main(){
	mat4 matrix = mat4(generalUniformBuffer[0], generalUniformBuffer[1], generalUniformBuffer[2], generalUniformBuffer[3]);
	matrix = matrix * mat4(generalUniformBuffer[4], generalUniformBuffer[5], generalUniformBuffer[6], generalUniformBuffer[7]);
	
	Quad qud = Quad(quad.xy, quad.zw);
	vec4 vgly = glyphs[index];
	Glyph gly = Glyph(vgly.xy, vgly.zw);
	
	outVer.style = styleBuffer[styleIndex];
	outVer.uv = vec2(gly.min.x * (1.0 - pos.x) + gly.max.x * pos.x, gly.min.y * pos.y + gly.max.y * (1.0 - pos.y));
	 
	gl_Position = vec4(qud.pos.x + pos.x * qud.size.x, qud.pos.y - (qud.size.y *(1.0 - pos.y)), 0.0, 1.0);
}





